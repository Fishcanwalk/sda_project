#!/usr/bin/env python
import os
import sys

# Add the project root to the path
project_root = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
sys.path.insert(0, project_root)

from webapp.web import create_app
from webapp.models.user_model import User


def init_admin():

    app = create_app()

    with app.app_context():
        # Check if admin user already exists
        admin_user = User.objects(username="admin").first()

        if admin_user:
            print("Admin user already exists. Updating password...")
            admin_user.set_password("admin")
            admin_user.roles = "admin"
            admin_user.save()
            print("✓ Admin password and role updated")
        else:
            print("Creating new admin user...")
            admin_user = User(username="admin")
            admin_user.set_password("admin")
            admin_user.roles = "admin"
            admin_user.save()
            print("✓ Admin user created successfully")

        print(f"Username: admin")
        print(f"Password: admin")


if __name__ == "__main__":
    try:
        init_admin()
    except Exception as e:
        print(f"Error: {e}", file=sys.stderr)
        sys.exit(1)
